---
title: "Getting started with spaCy"
description: |
  My first few days with this natural language processing tool
author:
  - name: Amanda Whitmire
    url: https://amandawhitmire.github.io/
    affiliation: Stanford Libraries & Hopkins Marine Station
date: 07-15-2021
collections:
  posts:
    disqus: getting-started-with-spacy
    share: [twitter, facebook]
output:
  distill::distill_article:
    self_contained: false
    toc: true
    toc_depth: 2
draft: false
preview: https://raw.githubusercontent.com/amandawhitmire/blog/main/images/spacy-render.png
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```
In my haste to get this blog and my fellowship project going, I never really took the time to describe what I'm going to be doing. I'll do this now, in the briefest possible terms. 

## Fellowship Goal:
Correctly identify species occurrences (species + place + date) from the text of the Proceedings of the Academy of Natural Sciences of Philadelphia (ANSP; 1841-1922)

<aside>
This corpus is available at the [Biodiversity Heritage Library](https://www.biodiversitylibrary.org/bibliography/6885) (BHL).
</aside>

## Why?
I am interested in how this corpus may be leveraged for historical species occurrence data so that I can contribute toward filling in the sparse occurrence data from this time period. Take a quick look at the data showing all species occurrence records from the Global Biodiversity Information Facility, [GBIF](https://www.gbif.org/), from 1800 - 2021. While the scale obscures the actual number of observations prior to 1950 (it's not zero!), you get the gist of the problem of a lack of "old data."

![GBIF species occurrences 1800-2021](https://raw.githubusercontent.com/amandawhitmire/blog/main/images/gbif-over-time.jpg)

<aside>
For inquiring minds who want to see the pre-1950 data. The top of the scale (too small to read) is 2M.

<img src="https://raw.githubusercontent.com/amandawhitmire/blog/main/images/gbif-pre1950.png" alt="GBIF data pre-1950" width="150"/>
</aside>

## How? 
I don't have it all figured out yet, but expect that this will involve _many_ steps of data processing and cleaning, training a natural language processing model on this corpus (which is a *weird* corpus), exploratory data analysis and visualization, and more. If we can get it to work (and this is a big IF), we will be able to automate identifying realtionships like the one shown below.^[from: Nguyen N, Gabud R, Ananiadou S (2019) COPIOUS: A gold standard corpus of named entities towards extracting species occurrence from biodiversity literature. Biodiversity Data Journal 7: e29626. https://doi.org/10.3897/BDJ.7.e29626] This example includes habitat, but we are focused on the relations between date + place + species.

<img src="https://raw.githubusercontent.com/amandawhitmire/blog/main/images/copious_spoc_2019_217808.png" alt="COPIOUS figure" width="600"/>
<aside>
_Examples of species occurrences automatically extracted by PASMED. A dashed line indicates an incorrect relation._
</aside>

To accomplish this, we are hoping to use the Python package [`spaCy`](https://spacy.io/). SpaCy is self-described as, "industrial-strength natural language processing in Python." This powerful package does many things, but the two things it does that we really need are: named entity recognition (it finds words/phrases in the text, and we can give it a list of things to look for) and entity relations (we can train it to know when things are related, like a species and a place). 

My first step in working toward this very lofty goal, was just to explore around in spaCy a bit. I did that, and you can see what I did in this [Jupyter Notebook](https://github.com/amandawhitmire/blog/blob/main/code/spacy-testing.ipynb). The major successes for this first exercise were to:

1. run the default spaCy NLP model on a volume of ANSP, 
2. to understand how to visualize some of the results:

![spaCy annotations from sample text](https://raw.githubusercontent.com/amandawhitmire/blog/main/images/spacy-render.png)

<aside>
. 

This shows some of spaCy's default entity types: CARDINAL (Numerals that do not fall under another type), PERSON, GPE (geopolitical), ORG (organizations), etc. Notice it misses the species mentioned, e.g., 'Ariolimax niger'.
</aside>
3. and, finally, to create a custom entity set with a few species names, add it to the existing NLP pipeline, and see if it works. 

It did! 

![NER results in spaCy showing the species name highlighted.](https://raw.githubusercontent.com/amandawhitmire/blog/main/images/spacy-success.png)

All in all, this was a very exciting and productive week!

/a